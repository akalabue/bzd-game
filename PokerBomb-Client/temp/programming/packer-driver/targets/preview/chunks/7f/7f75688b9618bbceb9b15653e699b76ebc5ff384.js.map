{"version":3,"sources":["file:///D:/Documents/OneDrive/%E6%A1%8C%E9%9D%A2/%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6%E5%A4%B9/%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/PokerBomb/PokerBomb-Client/assets/Script/games/bazhadan/BZDClient.ts"],"names":["_decorator","Component","ccclass","property","BZDClient","_ws","start","_init","update","deltaTime","globalThis","_BZDClient","_connectServer","ip","window","location","hostname","ws","WebSocket","_userInfo","room_id","user_id","onopen","console","log","requestRoomInfo","onmessage","result","message","data","obj","JSON","parse","_data","_type","type","responseServerMessage","onclose","onerror","err","_eventtarget","emit","sendMessage","sendData","send","stringify","roomId","userId"],"mappings":";;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;;;;;;OACf;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBH,U;;2BAGjBI,S,WADZF,OAAO,CAAC,WAAD,C,gBAAR,MACaE,SADb,SAC+BH,SAD/B,CACyC;AAAA;AAAA;AAAA,eAC7BI,GAD6B,GACjB,IADiB;AAAA;;AAGrCC,QAAAA,KAAK,GAAG;AACJ,eAAKC,KAAL;AACH;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AAEOF,QAAAA,KAAK,GAAG;AACZG,UAAAA,UAAU,CAACC,UAAX,GAAwB,IAAxB,CADY,CACiB;;AAC7B,eAAKC,cAAL;AACH;;AAEOA,QAAAA,cAAc,GAAE;AACpB,cAAIC,EAAE,GAAGC,MAAM,CAACC,QAAP,CAAgBC,QAAzB;AACA,cAAMC,EAAE,GAAG,IAAIC,SAAJ,SAAoBJ,MAAM,CAACC,QAAP,CAAgBC,QAApC,4BAAmEN,UAAU,CAACS,SAAX,CAAqBC,OAAxF,SAAmGV,UAAU,CAACS,SAAX,CAAqBE,OAAxH,CAAX;AACA,eAAKhB,GAAL,GAAWY,EAAX;;AACAA,UAAAA,EAAE,CAACK,MAAH,GAAY,MAAI;AACZC,YAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;AACA,iBAAKC,eAAL;AACH,WAHD;;AAIAR,UAAAA,EAAE,CAACS,SAAH,GAAgBC,MAAD,IAAU;AACrB,gBAAIC,OAAO,GAAGD,MAAM,CAACE,IAArB;AACA,gBAAIC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWJ,OAAX,CAAV;AACAL,YAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA2BM,GAA3B;AACA,gBAAIG,KAAK,GAAGH,GAAG,CAACD,IAAhB;AACA,gBAAIK,KAAK,GAAGJ,GAAG,CAACK,IAAhB;AACA,iBAAKC,qBAAL,CAA2BF,KAA3B,EAAkCD,KAAlC;AACH,WAPD;;AAQAhB,UAAAA,EAAE,CAACoB,OAAH,GAAa,MAAI;AACbd,YAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACH,WAFD;;AAGAP,UAAAA,EAAE,CAACqB,OAAH,GAAcC,GAAD,IAAO;AAChBhB,YAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4Be,GAA5B;AACH,WAFD;AAGH;AAED;AACJ;AACA;;;AAEWH,QAAAA,qBAAqB,CAACD,IAAD,EAAON,IAAP,EAAY;AACpCnB,UAAAA,UAAU,CAAC8B,YAAX,CAAwBC,IAAxB,CAA6BN,IAA7B,EAAmCN,IAAnC;AACH;;AAEOa,QAAAA,WAAW,CAACR,KAAD,EAAQD,KAAR,EAAc;AAC7B,cAAIU,QAAQ,GAAG;AACXR,YAAAA,IAAI,EAAED,KADK;AAEXL,YAAAA,IAAI,EAAEI;AAFK,WAAf;AAIAV,UAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAAyBmB,QAAzB;;AACA,eAAKtC,GAAL,CAASuC,IAAT,CAAcb,IAAI,CAACc,SAAL,CAAeF,QAAf,CAAd,EAN6B,CAMW;;AAC3C;;AAEMlB,QAAAA,eAAe,GAAE;AACpB,cAAII,IAAI,GAAG;AACPiB,YAAAA,MAAM,EAAEpC,UAAU,CAACS,SAAX,CAAqBC,OADtB;AAEP2B,YAAAA,MAAM,EAAErC,UAAU,CAACS,SAAX,CAAqBE;AAFtB,WAAX;AAIA,eAAKqB,WAAL,CAAiB,iBAAjB,EAAoCb,IAApC;AACH;;AA/DoC,O","sourcesContent":["import { _decorator, Component, Node } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('BZDClient')\nexport class BZDClient extends Component {\n    private _ws : any = null;\n\n    start() {\n        this._init();\n    }\n\n    update(deltaTime: number) {\n        \n    }\n\n    private _init() {\n        globalThis._BZDClient = this;//使得全局能够获取此对象\n        this._connectServer();\n    }\n\n    private _connectServer(){\n        let ip = window.location.hostname;\n        const ws = new WebSocket(`ws:${window.location.hostname}:9091/websocket/bzd/${globalThis._userInfo.room_id}/${globalThis._userInfo.user_id}`);\n        this._ws = ws;\n        ws.onopen = ()=>{\n            console.log(\"连接霸炸弹游戏服务器成功\");\n            this.requestRoomInfo();\n        }\n        ws.onmessage = (result)=>{\n            let message = result.data;\n            let obj = JSON.parse(message);\n            console.log(\"接收到霸炸弹服务器消息：\",obj);\n            let _data = obj.data;\n            let _type = obj.type;\n            this.responseServerMessage(_type, _data);\n        }\n        ws.onclose = ()=>{\n            console.log(\"与霸炸弹游戏服务器断开连接\");\n        }\n        ws.onerror = (err)=>{\n            console.log(\"霸炸弹服务器网络连接出错：\",err);\n        }\n    }\n\n    /**\n     * 响应服务端消息 type-->消息类型，  data-->消息数据\n     */\n\n    public responseServerMessage(type, data){\n        globalThis._eventtarget.emit(type, data);\n    }\n\n    private sendMessage(_type, _data){\n        let sendData = {\n            type: _type,\n            data: _data\n        }\n        console.log(\"游戏服务器发送信息：\",sendData)\n        this._ws.send(JSON.stringify(sendData));//将javascript对象转为字符串\n    }\n\n    public requestRoomInfo(){\n        let data = {\n            roomId: globalThis._userInfo.room_id,\n            userId: globalThis._userInfo.user_id\n        }\n        this.sendMessage(\"requestRoomInfo\", data);\n    }\n}\n\n"]}